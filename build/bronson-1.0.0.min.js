//   BronsonJS - v1.0.0 - 2013-01-17
//   http://github.com/eclifford/bronson/
//   Copyright (c) 2013 Eric Clifford; Licensed MIT
(function(){var e=[].slice,t={}.hasOwnProperty;(function(e,t){return typeof define=="function"&&define.amd?define([],t()):e.Bronson=t()})(this,function(){var n,r,i;return n=window.Bronson={version:"1.0.0",events:{},modules:{},publish:function(e){var t,n,r,i,s,o,u,a,f,l;i=/^[a-z]+((:[a-z]+){1})$/;if(!i.test(e))throw new Error("Bronson.publish: event must be in format subscriber or subscriber:channel:topic");r=e.toLowerCase().split(":"),n=r[0],u=r[1];if(!this.events[n][u])return!0;o=this.events[n][u].slice(),t=[].slice.call(arguments,1),l=[];for(a=0,f=o.length;a<f;a++)s=o[a],l.push(s.callback.apply(this,t));return l},subscribe:function(e,t,r){var i,s,o,u,a;o=/^[a-z]+((:[a-z]+){2})$/;if(!o.test(e))throw new Error("Bronson.subscribe: event must be in format subscriber or subscriber:channel:topic");if(t!=null&&typeof t!="function")throw new Error("Bronson.subscribe: callback must be a function");s=e.toLowerCase().split(":"),u=s[0],i=s[1],a=s[2];if(n.Permissions.enabled&&!n.Permissions.rules[u][i])throw new Error("Bronson#.subscribe: attempting to subscribe to unpermitted channel");return this.events[i]||(this.events[i]={}),this.events[i][a]=this.events[i][a]?this.events[i][a]:[],this.events[i][a].push({subscriber:u,context:r||this,callback:t})},unsubscribe:function(e){var t,n,r,i,s,o,u,a,f,l,c,h,p;r=/^[a-z]+((:[a-z]+){2})?$/;if(!r.test(e))throw new Error("Bronson.unsubscribe: event must be in format subscriber or subscriber:channel:topic");n=e.toLowerCase().split(":"),o=n[0],t=n[1],u=n[2];if(n.length===1){h=[];for(a in this.events)h.push(function(){var e;e=[];for(p in this.events[a])e.push(function(){var e,t,n,r;n=this.events[a][p],r=[];for(i=e=0,t=n.length;e<t;i=++e){s=n[i];if(s.subscriber===o){this.events[a][p].splice(i,1);break}r.push(void 0)}return r}.call(this));return e}.call(this));return h}c=this.events[t][u];for(i=f=0,l=c.length;f<l;i=++f){s=c[i];if(s.subscriber===o){this.events[t][u].splice(i,1);return}}},load:function(e,t,n,r){var i=this;r==null&&(r=!0);if(e==null||typeof e!="string")throw new Error("Bronson.Core#loadModule: must supply a valid module");if(n!=null&&typeof n!="function")throw new Error("Bronson.load: callback must be in the form of a function");if(r!=null&&typeof r!="boolean")throw new Error("Bronson.Core#loadModule: autostart must be a valid boolean");return require(["module",e],function(s,o){var u;try{return u=new o(t),u.id=s.id,i.modules[e]=i.modules[e]?i.modules[e]:[],i.modules[e].push(u),u.load(),window.module=u,r&&u.start(),n(u)}catch(a){throw new Error("Bronson.Core#loadModule: "+a)}},function(e){var t;throw e.requireType==="timeout"?new Error:(t=e.requireModules&&e.requireModules[0],require.undef(t),e)})},unload:function(e){var t,n,r,i,s,o,u,a,f,l,c;if(e==null||typeof e!="string")throw new Error("Bronson.Core#unloadModule: id must be valid");try{for(i in this.modules)if(this.modules.hasOwnProperty(i)){l=this.modules[i];for(s=o=0,a=l.length;o<a;s=++o){n=l[s];if(n.id===e){n.unload(),this.modules[i].splice(s,1);return}}}this.modules[i].length===0&&(require.undef(i),delete this.modules[i]),t=require.s.contexts._.defined,c=[];for(u=0,f=t.length;u<f;u++)r=t[u],t.hasOwnProperty(r)&&r.indexOf(channel)!==-1?c.push(require.undef(r)):c.push(void 0);return c}catch(h){throw new Error("Bronson.Core#unloadModule: "+h)}},unloadAll:function(){var e,t,n;n=[];for(t in this.modules)this.modules.hasOwnProperty(t)?n.push(function(){var n,r,i,s;i=this.modules[t],s=[];for(n=0,r=i.length;n<r;n++)e=i[n],s.push(this.unloadModule(e.id));return s}.call(this)):n.push(void 0);return n},start:function(e){var t,n,r,i,s,o;for(n in this.modules)if(this.modules.hasOwnProperty(n)){o=this.modules[n];for(r=i=0,s=o.length;i<s;r=++i){t=o[r];if(t.id===e){t.start();return}}}},stop:function(e){var t,n,r,i,s;for(n in this.modules)if(this.modules.hasOwnProperty(n)){s=this.modules[n];for(r=0,i=s.length;r<i;r++){t=s[r];if(t.id===e){t.stop();return}}}},stopAll:function(){var e,t,n;n=[];for(t in this.modules)this.modules.hasOwnProperty(t)?n.push(function(){var n,r,i,s;i=this.modules[t],s=[];for(n=0,r=i.length;n<r;n++)e=i[n],s.push(e.stop());return s}.call(this)):n.push(void 0);return n}},n.on=n.subscribe,n.trigger=n.publish,i=n.Util={extend:function(){var n,r,i,s,o,u,a;i=arguments[0],n=2<=arguments.length?e.call(arguments,1):[];if(i==null)return{};for(u=0,a=n.length;u<a;u++){s=n[u];for(r in s){if(!t.call(s,r))continue;o=s[r],i[r]==null||typeof o!="object"?i[r]=o:i[r]=this.extend(i[r],o)}}return i}},r=n.Permissions={enabled:!1,rules:{},set:function(e){return this.rules=n.Util.extend(this.rules,e)},validate:function(e,t){var n,r;if(e==null||typeof e!="string")throw new Error("Bronson.Permissions#validate: must provide a valid subscriber");if(t==null||typeof t!="string")throw new Error("Bronson.Permissions#validate: must provide a valid channel");return this.enabled?(n=(r=this.rules[e])!=null?r[t]:void 0,n===void 0?!1:n):!0}},n.Module=function(){function e(){}return e.prototype.id="",e.prototype.disposed=!1,e.prototype.started=!1,e.prototype.load=function(){throw new Error("Bronson.Module#initialize: must override initialize")},e.prototype.start=function(){return this.started=!0},e.prototype.stop=function(){return this.started=!1},e.prototype.unload=function(){if(this.disposed)return;return this.disposed=!0,typeof Object.freeze=="function"?Object.freeze(this):void 0},e}(),n})}).call(this);