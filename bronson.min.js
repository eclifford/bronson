/*! bronson.js - v2.0.0 - Eric Clifford <ericgclifford@gmail.com> - 2013-11-13 */!function(a,b){"undefined"!=typeof exports?b(a,exports):"function"==typeof define&&define.amd?define(["exports"],function(c){a.Bronson=b(a,c)}):a.Bronson=b(a,{})}(this,function(a,b){var c=function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a};c(b,{version:"2.0.0",defaults:{autoload:!0,autostart:!0,permissions:!1,success:function(){},error:function(){}},modules:{},events:{},publish:function(a){var c,d,e,f,g=/^[a-z]+((:[a-z]+){1})$/,h=a.toLowerCase(),i=[];if(!g.test(h))throw new Error("Bronson.publish: event name must be in format subscriber of channel:topic");if(i=h.split(":"),c=i[0],d=i[1],b.events[c]&&b.events[c][d]){e=b.events[c][d].slice(),f=[].slice.call(arguments,1);for(var j in e)e[j].callback.apply(this,f)}},subscribe:function(a,c,d){var e,f,g,h,i=/^[a-z]+((:[a-z]+){2})$/,j=a.toLowerCase();if(!i.test(j))throw new Error("Bronson.subscribe: event "+j+" must be in format subscriber or subscriber:channel:topic");if("undefined"!=typeof c&&null!==c&&"function"!=typeof c)throw new Error("Bronson.subscribe: callback must be a function");return e=j.split(":"),f=e[0],g=e[1],h=e[2],this.permissions&&!b.Permissions.validate(f,g)?!1:(this.events[g]||(this.events[g]={}),this.events[g][h]=this.events[g][h]?this.events[g][h]:[],this.events[g][h].push({subscriber:f,context:d||this,callback:c}),void 0)},unsubscribe:function(a){var b,c,d,e,f,g=/^[a-z]+((:[a-z]+){2})?$/,h=a.toLowerCase(),i=[];if(!g.test(h))throw new Error("Bronson.unsubscribe: event must be in format subscriber or subscriber:channel:topic");if(i=h.split(":"),b=i[0],c=i[1],d=i[2],1===i.length){for(c in this.events)for(d in this.events[c])for(e=0;e<this.events[c][d].length;e++)if(this.events[c][d][e].subscriber===b){this.events[c][d].splice(e,1);break}}else for(e=0;e<this.events[c][d].length;e++)if(f=this.events[c][d][e],f.subscriber===b)return this.events[c][d].splice(e,1),void 0},load:function(a){if(!a)throw new Error("Bronson.load: must supply valid parameter modules");for(var d=0;d<a.length;d++)try{var e,f;if("object"==typeof a[d])e=Object.getOwnPropertyNames(a[d])[0],f=c(this.defaults,a[d][e]);else{if("string"!=typeof a[d])throw new Error("Bronson.load: Please supply a valid object or string to load");e=a[d],f=this.defaults}require(["module",e],function(a,c){var d=(new c,new c(f.data));d.id=a.id,d.type=e,b.modules[e]=b.modules[e]?b.modules[e]:[],b.modules[e].push(d),f.autoload&&d.load(),f.autostart&&d.start(),f.success&&f.success()})}catch(g){f.error&&f.error(g)}},unload:function(a){if("undefined"==typeof a||null===a||"string"!=typeof a)throw new Error("Bronson.unload: id must be valid");var b=this.find(a),c=this.modules[b.type].indexOf(b);this.modules[b.type].splice(c,1),0===this.modules[b.type].length&&(require.undef(b.type),delete this.modules[b.type]),contextMap=require.s.contexts._.defined;for(var d in contextMap)contextMap.hasOwnProperty(d)&&require.undef(d)},unloadAll:function(){for(var a=this.all(),b=0;b<a.length;b++)this.unload(a[b].id)},start:function(){var a=b.find(id);a.started||a.start()},startAll:function(){for(var a=this.all(),b=0;b<a.length;b++)a[b].started||a[b].start()},stop:function(){var a=b.find(id);a.started&&a.stop()},stopAll:function(){for(var a=this.all(),b=0;b<a.length;b++)a[b].started&&a[b].stop()},find:function(a){var b=this.modules;for(var c in b)if(b.hasOwnProperty(c))for(var d in b[c])if(b[c][d].id===a)return b[c][d]},findAll:function(){var a=[],b=this.modules;for(var c in b)if(b.hasOwnProperty(c))for(var d in b[c])a.push(b[c][d]);return a}}),b.Module=function(){function a(){}return a.prototype.id="",a.prototype.disposed=!1,a.prototype.started=!1,a.prototype.load=function(){throw new Error("Bronson.Module.load: must override load")},a.prototype.start=function(){return this.started=!0,this.started},a.prototype.stop=function(){return this.started=!1,this.started},a.prototype.unload=function(){return this.disposed?void 0:(this.disposed=!0,"function"==typeof Object.freeze?Object.freeze(this):void 0)},a}(),b.Permissions={rules:{},set:function(a){this.rules=c(this.rules,a)},validate:function(a,b){return this.enabled&&this.rules[a]?this.rules[a][b]?!0:!0:void 0}};var d=function(a){function b(){this.constructor=d}var d,e={}.hasOwnProperty,f=this;return d=a&&e.call(a,"constructor")?a.constructor:function(){return f.apply(this,arguments)},b.prototype=f.prototype,d.prototype=new b,a&&c(d.prototype,a),d.__super__=f.prototype,d};return b.on=b.subscribe,b.trigger=b.publish,b.Module.extend=d,b});