/*! bronsonjs - v2.0.9 - eclifford <ericgclifford@gmail.com> - 2013-12-15 */!function(a,b){"undefined"!=typeof exports?b(a,exports):"function"==typeof define&&define.amd?define(["exports"],function(c){a.Bronson=b(a,c)}):a.Bronson=b(a,{})}(this,function(a,b){var c=function(a,b){for(var d in b)d in a&&"object"==typeof b[d]&&null!==d?c(a[d],b[d]):a[d]=b[d];return a};c(b,{version:"2.0.9",settings:{options:{autoload:!0,autostart:!0,permissions:!1},success:function(){},error:function(){}},modules:{},events:{},publish:function(a){var c,d,e,f,g=/^[a-z]+((:[a-z]+){1})$/,h=a.toLowerCase(),i=[];if(!g.test(h))throw new Error("Bronson.publish: event name must be in format subscriber of channel:topic");if(i=h.split(":"),c=i[0],d=i[1],b.events[c]&&b.events[c][d]){e=b.events[c][d].slice(),f=[].slice.call(arguments,1);for(var j in e)e[j].callback.apply(this,f)}},subscribe:function(a,c,d){var e,f,g,h,i=/^[a-zA-Z0-9]+((:[a-zA-Z0-9]+){2})$/,j=a.toLowerCase();if(!i.test(j))throw new Error("Bronson.subscribe: event "+j+" must be in format subscriber or subscriber:channel:topic");if("undefined"!=typeof c&&null!==c&&"function"!=typeof c)throw new Error("Bronson.subscribe: callback must be a function");if(e=j.split(":"),f=e[0],g=e[1],h=e[2],this.settings.permissions&&!b.Permissions.validate(f,g))throw new Error("Bronson.subscribe: permissions do not allow this subscriber to listen to that channel");this.events[g]||(this.events[g]={}),this.events[g][h]=this.events[g][h]?this.events[g][h]:[],this.events[g][h].push({subscriber:f,context:d||this,callback:c})},unsubscribe:function(a){var b,c,d,e,f,g=/^[a-zA-Z0-9]+((:[a-zA-Z0-9]+){2})?$/,h=a.toLowerCase(),i=[];if(!g.test(h))throw new Error("Bronson.unsubscribe: event must be in format subscriber or subscriber:channel:topic");if(i=h.split(":"),b=i[0],c=i[1],d=i[2],1===i.length)for(c in this.events)for(d in this.events[c])for(e=this.events[c][d].length-1;e>=0;e--)this.events[c][d][e].subscriber===b&&this.events[c][d].splice(e,1);else for(e=this.events[c][d].length-1;e>=0;e--)f=this.events[c][d][e],f.subscriber===b&&this.events[c][d].splice(e,1)},load:function(a){if(!a)throw new Error("Bronson.load: must supply valid parameter modules");a instanceof Array||(a=[a]);for(var b=0;b<a.length;b++){if(!a[b].id)throw new Error("Bronson.load: must supply id parameter");if(!a[b].path)throw new Error("Bronson.load: must supply path parameter");a[b]=c(c({},this.settings),a[b]),d(a[b])}},unload:function(a){if("undefined"==typeof a||null===a||"string"!=typeof a)throw new Error("Bronson.unload: id must be valid");var b=this.find(a),c=this.modules[b.type].indexOf(b);this.modules[b.type].splice(c,1),0===this.modules[b.type].length&&(require.undef(b.type),delete this.modules[b.type]),contextMap=require.s.contexts._.defined;for(var d in contextMap)contextMap.hasOwnProperty(d)&&require.undef(d)},unloadAll:function(){for(var a=this.all(),b=0;b<a.length;b++)this.unload(a[b].id)},start:function(a){var c=b.find(a);c.started||c.start()},startAll:function(){for(var a=this.findAll(),b=0;b<a.length;b++)a[b].started||a[b].start()},stop:function(a){var c=b.find(a);c.started&&c.stop()},stopAll:function(){for(var a=this.findAll(),b=0;b<a.length;b++)a[b].started&&a[b].stop()},find:function(a){var b=this.modules;for(var c in b)if(b.hasOwnProperty(c))for(var d in b[c])if(b[c][d].id===a)return b[c][d]},findAll:function(){var a=[],b=this.modules;for(var c in b)if(b.hasOwnProperty(c))for(var d in b[c])a.push(b[c][d]);return a}}),b.Module=function(){function a(){}return a.prototype.id="",a.prototype.disposed=!1,a.prototype.started=!1,a.prototype.load=function(a){this.id=a.id,this.path=a.path,this.onLoad(a.data)},a.prototype.onLoad=function(){},a.prototype.start=function(){this.started=!0,this.onStart()},a.prototype.onStart=function(){},a.prototype.stop=function(){this.started=!1,this.onStop()},a.prototype.onStop=function(){},a.prototype.unload=function(){return this.disposed?void 0:(this.disposed=!0,this.onUnload(),"function"==typeof Object.freeze?Object.freeze(this):void 0)},a.prototype.onUnload=function(){},a}(),b.Permissions={rules:{},set:function(a){this.rules=c(this.rules,a)},validate:function(a,c){return b.settings.permissions?this.rules[a]?this.rules[a][c]?!0:!1:!1:void 0}};var d=function(a){try{require(["module",a.path],function(d,e){var f=new e;b.modules[a.path]=b.modules[a.path]?b.modules[a.path]:[],b.modules[a.path].push(f),c(d,{path:a.path}),a.options.autoload&&f.load(a),a.options.autostart&&f.start(),a.success&&a.success(f)})}catch(d){a.error&&a.error(d)}},e=function(a){function b(){this.constructor=d}var d,e={}.hasOwnProperty,f=this;return d=a&&e.call(a,"constructor")?a.constructor:function(){return f.apply(this,arguments)},b.prototype=f.prototype,d.prototype=new b,a&&c(d.prototype,a),d.__super__=f.prototype,d};return b.on=b.subscribe,b.trigger=b.publish,b.Module.extend=e,b});